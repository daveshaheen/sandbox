<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Test</title>

    <script src="https://apis.google.com/js/platform.js?onload=initializeGoogleSignIn" async defer></script>

    <style>
        html {
            font-family: Roboto, sans-serif;
        }

        body div {
            margin: 1em 0;
        }

        .cloak,
        .hide {
            display: none;
        }
    </style>
</head>

<body>
    <p>Hello World!</p>
    <div>
        <button id="google-signin" class="cloak" onclick="handleAuthentication()">Sign In</button>
    </div>
    <div>
        <button id="google-revoke" class="hide" onclick="revokeAccess()">Revoke Access</button>
    </div>
    <script>
        var sso = {
            // googleAuth is set after platform.js loads from the initializeGoogleSignIn method
            googleAuth: null,
            googleAuthConfig: {
                client_id: '[ClientID].apps.googleusercontent.com',
                fetch_basic_profile: true
            },
            googleAuthListener: (isSignedIn) => {
                handleAuthChange(isSignedIn);
            },
            // googleUser is set by the googleAuthListener upon sign in
            googleUser: null
        };

        var initializeGoogleSignIn = () => {
            // reference: https://developers.google.com/identity/sign-in/web/reference
            // load gapi auth2 library
            gapi.load('auth2',
                () => {
                    // initialize auth2
                    gapi.auth2.init(sso.googleAuthConfig).then(() => {
                        // gapi.auth2.GoogleAuth finished initializing
                        var googleAuth = gapi.auth2.getAuthInstance();
                        var isSignedIn = googleAuth.isSignedIn.get();

                        sso.googleAuth = googleAuth;

                        deCloak();
                        handleAuthChange(isSignedIn);
                    }, (error) => {
                        // gapi.auth2.GoogleAuth failed to initialize
                        console.error(error);
                    });
                });
        };

        var deCloak = () => {
            var items = document.querySelectorAll('.cloak');
            for (var i = 0; i < items.length; i++) {
                items[i].classList.remove('cloak');
            }
        };

        var handleAuthChange = (isSignedIn) => {
            var googleSignInButton = document.querySelector('#google-signin');
            var googleRevokeButton = document.querySelector('#google-revoke');

            googleSignInButton.textContent = isSignedIn ? "Sign Out" : "Sign In";

            if (isSignedIn) {
                sso.googleUser = sso.googleAuth.currentUser.get();

                googleRevokeButton.classList.remove('hide');
            } else {
                googleRevokeButton.classList.add('hide');
            }
        }

        var handleAuthentication = () => {
            var googleAuth = sso.googleAuth;
            var isSignedIn = googleAuth.isSignedIn.get();

            googleAuth.isSignedIn.listen(sso.googleAuthListener)
            if (isSignedIn) {
                googleAuth.signOut();
            } else {
                googleAuth.signIn();
            }
        };

        var revokeAccess = () => {
            sso.googleAuth.disconnect();
        };
    </script>
</body>

</html>
